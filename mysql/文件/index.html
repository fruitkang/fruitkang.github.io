<!doctype html>
<html lang="zh-CN">
  <head>
    <title>MySQL文件 // 果汁康</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="果汁康" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL文件"/>
<meta name="twitter:description" content="1、简介    文件 作用     参数文件 告诉mysql启动时去哪里找数据库文件，并指定某些初始化参数   日志文件 记录mysql实例对某种条件做出响应时写入的文件   socket文件 当用unix域套接字方式进行连接时需要的文件   pid文件 mysql实例进程的ID文件   mysql表结构文件 用来存放mysql表结构定义文件   存储引擎文件 存储记录和索引的数据    2、参数为文件 参数文件位置：通过运行mysql --help | grep my.cnf命令即可。 参数类型：
 动态参数：可以在mysql实例运行中进行修改 静态参数：在整个实例生命周期内都不能修改  还可以按照其他角度分类：
 全局 session
3、日志文件 日志文件用来记录影响Mysql数据库的各类型活动。常见日志有：
   错误日志（error log） 二进制日志（binlog） 慢查询日志（slow query log） 查询日志（log）
3.1、错误日志 通过show variables like &#39;log_error&#39;;错误日志文件位置。
   3."/>

    <meta property="og:title" content="MySQL文件" />
<meta property="og:description" content="1、简介    文件 作用     参数文件 告诉mysql启动时去哪里找数据库文件，并指定某些初始化参数   日志文件 记录mysql实例对某种条件做出响应时写入的文件   socket文件 当用unix域套接字方式进行连接时需要的文件   pid文件 mysql实例进程的ID文件   mysql表结构文件 用来存放mysql表结构定义文件   存储引擎文件 存储记录和索引的数据    2、参数为文件 参数文件位置：通过运行mysql --help | grep my.cnf命令即可。 参数类型：
 动态参数：可以在mysql实例运行中进行修改 静态参数：在整个实例生命周期内都不能修改  还可以按照其他角度分类：
 全局 session
3、日志文件 日志文件用来记录影响Mysql数据库的各类型活动。常见日志有：
   错误日志（error log） 二进制日志（binlog） 慢查询日志（slow query log） 查询日志（log）
3.1、错误日志 通过show variables like &#39;log_error&#39;;错误日志文件位置。
   3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fruitkang.github.io/mysql/%E6%96%87%E4%BB%B6/" />
<meta property="article:published_time" content="2023-06-20T22:12:50&#43;08:00"/>
<meta property="article:modified_time" content="2023-06-20T22:12:50&#43;08:00"/>


  </head>
  <body>
    <header class="app-header">
      <a href="https://fruitkang.github.io/"><img class="app-header-avatar"  src="/11.png" alt="果汁康" /></a>
      <span style="color: #00cf8f;" class="app-header-title"><img style="vertical-align:middle;size: inherit;" src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306210244464.png"/> 果汁康</span>
      
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">全部</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/works">工作</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/books">读书推荐</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/mysql">MySQL</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/java">Java</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/framework">框架</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/redis">Redis</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/nginx">Nignx</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/tools">小工具</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/linux">Linux</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/docker">Docker</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/others">Others</a>
      </nav>
        
      <p style="color: #00cf8f;line-height: normal;text-align: center;">
        赤色的旗帜一定会在全球飘扬!!!
      </p>

      <p style="font-size: small;">
        <span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
            <title>Github</title>
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
          </svg>
          <span>
            本站所有图片都来自于Github，如遇图片丢失，请自行解决！
            
          </span>
          
        </span>
      </p>
      <div class="app-header-social">
        
          <a href="https://github.com/fruitkang" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">MySQL文件</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jun 20, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          1 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://fruitkang.github.io/tags/mysql/">Mysql</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      

<h2 id="1-简介">1、简介</h2>

<table>
<thead>
<tr>
<th><strong>文件</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>

<tbody>
<tr>
<td>参数文件</td>
<td>告诉mysql启动时去哪里找数据库文件，并指定某些初始化参数</td>
</tr>

<tr>
<td>日志文件</td>
<td>记录mysql实例对某种条件做出响应时写入的文件</td>
</tr>

<tr>
<td>socket文件</td>
<td>当用unix域套接字方式进行连接时需要的文件</td>
</tr>

<tr>
<td>pid文件</td>
<td>mysql实例进程的ID文件</td>
</tr>

<tr>
<td>mysql表结构文件</td>
<td>用来存放mysql表结构定义文件</td>
</tr>

<tr>
<td>存储引擎文件</td>
<td>存储记录和索引的数据</td>
</tr>
</tbody>
</table>

<h2 id="2-参数为文件">2、参数为文件</h2>

<p>参数文件位置：通过运行<code>mysql --help | grep my.cnf</code>命令即可。
<img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055488.png" alt="image.png" />
参数类型：</p>

<ul>
<li>动态参数：可以在mysql实例运行中进行修改</li>
<li>静态参数：在整个实例生命周期内都不能修改</li>
</ul>

<p>还可以按照其他角度分类：</p>

<ul>
<li>全局</li>

<li><p>session</p>

<h2 id="3-日志文件">3、日志文件</h2>

<p>日志文件用来记录影响Mysql数据库的各类型活动。常见日志有：</p></li>
</ul>

<ol>
<li>错误日志（error log）</li>
<li>二进制日志（binlog）</li>
<li>慢查询日志（slow query log）</li>

<li><p>查询日志（log）</p>

<h3 id="3-1-错误日志">3.1、错误日志</h3>

<p>通过<code>show variables like 'log_error';</code>错误日志文件位置。</p></li>
</ol>

<ul>
<li><p><img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055068.png" alt="image.png" /></p>

<h3 id="3-2-慢查询日志">3.2、慢查询日志</h3>

<p>默认情况数据库不启动该日志，需要手动将<code>log_slow_queries</code>设置为on</p>

<h3 id="3-3-查询日志">3.3、查询日志</h3>

<h3 id="3-4-二进制日志">3.4、二进制日志</h3>

<p>binlog日志记录mysql数据库执行更改的所有操作，若更改操作本身并没有导致数据库发生变化，那么该操作可能也会写入二进制日志。
二进制日志作用：</p></li>
</ul>

<ol>
<li>恢复</li>
<li>复制（实时同步）</li>
<li>审计</li>
</ol>

<p>二级制日志默认不开启，通过配置log-bin[=name]参数开启二进制日志，name为日志文件名，若不指定，则默认为主机名。</p>

<pre><code class="language-shell">server_id=2
log_bin=mysql-bin
binlog_format=ROW
expire_logs_days=30
</code></pre>

<p><img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055917.png" alt="image.png" />
影响二进制日志记录的参数</p>

<ul>
<li>max_binlog_size</li>
<li>binlog_cache_size</li>
<li>sync_binlog</li>
<li>binlog_do_log</li>
<li>binlog_ingore_db</li>
<li>log_slave_update</li>
<li>binlog_format
| <strong>参数</strong> | <strong>作用和影响</strong> |
| &mdash; | &mdash; |
| max_binlog_size | 单个二进制文件最大值，超过则产生新的二进制文件，后缀名+1，并记录到.index文件中，默认1G  |
| binlog_cache_size | 当使用事务时，所有未提交的二进制日志会被记录到一个缓存中，该缓存的大小由binlog_cache_size参数决定，默认32K。该参数时基于session的。当一个线程开启一个事务的时候，mysq会自动分配一个大小为|
|binlog_cache_size的缓存区，因此该值不能太大，当一个事务的记录大于设定的缓存区大小，那mysql会将缓冲区的日志写入一个日志文件中，因此该值由不能太小。||
|通过<code>show global status</code>查看该缓存区的状态||
|<img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055469.png" alt="image.png" /> ||
| sync_binlog | 默认情况，二进制日志并不是每次写的时候同步磁盘，可理解为缓冲写。因此当数据库发生宕机时，可能会有最后一部分数据没有写入binlog，这会给恢复和复制带来问题。参数sync_binlog=【N】表示写多少次同步到缓冲。|
|N=1：同步写磁盘的方式写binlog。这是将不适用缓冲区，直接写如磁盘。||
|N=0：默认值||
|若想要使用innodb存储引擎进行复制，并且想得到最大高可用性，建议该值设置为ON，但这会带来一定的io问题。 ||
| binlog_format | 记录二进制日志的格式 |
| binlog_do_log||
| 需要写入那些库的日志，默认为空，表示写入所有的库 ||
| binlog_ingore_db | 需要忽略写入那些库的日志，默认为空，表示写入所有的库 |
| log_slave_update | 如果数据库为slave角色，默认不会将master取得的二进制日志写入自己的二进制日志中去。如果需要写入，要设置该参数。如果搭建master-&gt;slave-&gt;slave架构的复制，则必须设置该参数。 |</li>
</ul>

<h2 id="4-套接字文件">4、套接字文件</h2>

<h2 id="5-pid文件">5、pid文件</h2>

<h2 id="6-表结构定义文件">6、表结构定义文件</h2>

<p>无论哪种存储引擎，都有一个以frm为后缀名的文件，该文件记录了该表的表结构定义。</p>

<h2 id="7-innodb-存储引擎文件">7、innodb 存储引擎文件</h2>

<p>上面所有文件都是mysql数据库本身的文件，下面介绍innodb存储引擎密切相关的文件。</p>

<h3 id="7-1-表空间文件-tablespace">7.1、表空间文件（tablespace）</h3>

<p>innodb采用将存储的数据按照表空间进行存放的设计。默认配置下会有一个初始大小为10MB，名为idbdata1的文件。</p>

<h3 id="7-2-重做日志">7.2、重做日志</h3>

<p>重做日志文件位置
<img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055500.png" alt="image.png" />
重做日志作用：当实例或介质失败时，重做日志可以派上用场，innodb存储引擎会使用重做日志恢复到失败时刻，以此保证数据完整性。
规则：</p>

<ol>
<li>每个innodb存储引擎至少有1个重做日志组，每个文件组下至少有2个重做日志文件。</li>
<li>为了提供高可用，可以设置多个镜像日志组。</li>
<li>每个日志组中每个重做日志文件大小一致，并以循环写的方式运行。</li>

<li><p>innodb存储引擎先写重做日志文件1，当到达重做日志文件1最后时，会切换到重做日志文件2，再当重组日志文件2页被写满时，会再次切换到重做日志文件1中。</p>

<h4 id="影响重做日志的文件">影响重做日志的文件</h4>

<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>

<tbody>
<tr>
<td>innodb_log_file_size</td>
<td>指定每个重做日志文件的大小。</td>
</tr>

<tr>
<td>innodb_log_file_in_group</td>
<td>指定每个日志文件组中重做日志文件的数量，默认为2</td>
</tr>

<tr>
<td>innodb_mirrored_log_group</td>
<td>指定日志文件组的数量，默认为1</td>
</tr>

<tr>
<td>innodb_log_group_home_dir</td>
<td>日志文件组所在路径</td>
</tr>
</tbody>
</table></li>
</ol>

<p>重做日志文件大小设置对于innodb存储引擎的性能有着非常大的影响。不能太大，会导致恢复时间较长。不能太小，会导致多次切换重做日志文件，也会导致频繁的发生async checkpoint，导致性能抖动。</p>

<h4 id="重做日志与二进制日志的区别">重做日志与二进制日志的区别</h4>

<ol>
<li>二进制日志记录所有与Mysql数据库相关的日志记录，包括其他存储引擎。</li>
<li>重做日志只记录了与innodb存储引擎本身事务的日志。</li>
<li>二进制日志记录的都是关于一个事务的具体操作内容，即该日志时逻辑日志。而重做日志记录的是关于每个页的更改的物理情况。</li>

<li><p>写入时间不同，二进制仅在事务提交前尽心提交，即只写磁盘一次。而在事务进行过程中，却不断有重做日志条目被写入到重做日志文件中。</p>

<h4 id="重做日志写入过程">重做日志写入过程</h4>

<p><img src="https://raw.githubusercontent.com/fruitkang/picgo/main/202306222055296.jpeg" alt="" />
从重做日志缓冲往磁盘写入时，是按512个字节，也就是一个扇区的大小进行写入。因为扇区是写入的最小单位，因此可以保证写入必定是成功的。因此在重做日志的写入过程中不需要doublewrite。</p>

<h4 id="重做日志写入时机">重做日志写入时机</h4></li>
</ol>

<ul>
<li>主线程每秒将重做日志缓冲写入磁盘的重做日志文件中。</li>
<li>在事务提交时，处理重做日志，由参数innodb_flush_log_at_trx_commit参数控制。innodb_flush_log_at_trx_commit参数的有效值有0、1、2。0代表当事务提交时，不将事务的重做日志写入磁盘，而是等主线程刷新。1和2不同在于，1表示执行提交事务时将重做日志同步写磁盘，即将会调用操作系统的fsync。2表示将重做日志吸入文件系统缓冲中，因此不能保证执行提交事务时肯定会写入重做日志。为了保证事务的持久性，必须将该参数设置为1.</li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
